% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/predict.CBFM.R
\name{predict.CBFM}
\alias{predict.CBFM}
\alias{predict.CBFM_hurdle}
\title{Construct predictions for a (hurdle) CBFM fit}
\usage{
\method{predict}{CBFM}(
  object,
  newdata = NULL,
  manualX = NULL,
  new_B_space = NULL,
  new_B_time = NULL,
  new_B_spacetime = NULL,
  type = "link",
  se_fit = FALSE,
  coverage = 0.95,
  ncores = NULL,
  num_sims = 500,
  return_internals = FALSE,
  ...
)

\method{predict}{CBFM_hurdle}(
  object,
  newdata_pa = NULL,
  manualX_pa = NULL,
  new_B_space_pa = NULL,
  new_B_time_pa = NULL,
  new_B_spacetime_pa = NULL,
  newdata_count = NULL,
  manualX_count = NULL,
  new_B_space_count = NULL,
  new_B_time_count = NULL,
  new_B_spacetime_count = NULL,
  se_fit = FALSE,
  coverage = 0.95,
  ncores = NULL,
  num_sims = 500,
  ...
)
}
\arguments{
\item{object}{An object of class \code{CBFM}.}

\item{newdata}{A data frame containing the values of the covariates at which predictions are to be calculated. If this is not provided, then predictions corresponding to the original data are returned. If \code{newdata} is provided then it should contain all the variables needed for prediction, that is, it can construct a model matrix from this as \code{object$formula_X}.}

\item{manualX}{A manually supplied model matrix at which predictions are to be calculated. This can be used if for some reason the user wants to supply a very custom model matrix for calculating predictions. Note supply of this overrides any supplied \code{newdata} argument. The number of columns in \code{manualX} should equal to \code{ncol(object$betas)}.}

\item{new_B_space}{A matrix of new spatial basis functions at which predictions are to be calculated. If this is not provided, then predictions corresponding to the original \code{B_space} argument are returned. Please note this should only be supplied if \code{B_space} was supplied in the original CBFM fit.}

\item{new_B_time}{A matrix of new temporal basis functions at which predictions are to be calculated. If this is not provided, then predictions corresponding to the original \code{B_time} argument are returned. Please note this should only be supplied if \code{B_time} was supplied in the original CBFM fit.}

\item{new_B_spacetime}{A matrix of new spatio-temporal basis functions at which predictions are to be calculated. If this is not provided, then predictions corresponding to the original \code{B_spacetime} argument are returned. Please note this should only be supplied if \code{B_spacetime} was supplied in the original CBFM fit.}

\item{type}{The type of prediction required. The default \code{type = "link"} is on the scale of the linear predictors. Alternatively, \code{type = "response"} returns predictions on the scale of the response variable. For example, the predicted response for a binomial CBFM are the predicted probabilities.
Note that zero-inflated distributions, \code{type = "link"} returns the predicted linear predictor of the non-zero-inflated component, consistent with what \code{object$linear_predictors} returns. But \code{type = "response"} returns the \emph{actual predicted mean values} of the distribution, consistent with what \code{object$fitted} returns.
Similarly, for zero-truncated distributions, code{type = "link"} returns the predicted linear predictor of the base count distribution, consistent with what \code{object$linear_predictors} returns. But \code{type = "response"} returns the \emph{actual predicted mean values} of the zero-truncated distribution, consistent with what \code{object$fitted} returns.
A third option is given by \code{type  = "lpmatrix"}, which returns the model matrix of the covariates constructing (potentially) using \code{newdata}. In \code{\link[mgcv:predict.gam]{mgcv::predict.gam()}}, this is also known as the linear predictor matrix. Note under this option, arguments such as \code{new_B_space/new_B_time/new_B_spacetime/se_fit/coverage} are irrelevant and hence ignored.
Finally, for hurdle CBFMS, this option is not available as by default only predicted mean values i.e., \code{type = "response"} are possible.}

\item{se_fit}{When this is set to \code{TRUE} (not default), then standard error estimates are returned for each predicted value.}

\item{coverage}{The coverage probability of the uncertainty intervals for prediction. Defaults to 0.95, which corresponds to 95\% uncertainty intervals.}

\item{ncores}{To speed up calculation of the standard error estimates, parallelization can be performed, in which case this argument can be used to supply the number of cores to use in the parallelization. Defaults to \code{detectCores()-1}.}

\item{num_sims}{If simulation is required for constructing uncertainty intervals, then this specifies the number of Monte-Carlo examples to simulate.}

\item{return_internals}{Not used. Please ignore this argument!}

\item{...}{Not used.}

\item{newdata_pa}{For hurdle CBFM models, similar to \code{newdata} above but applied to the presence-absence component model.}

\item{manualX_pa}{For hurdle CBFM models, similar to \code{manual_X} above but applied to the presence-absence component model.}

\item{new_B_space_pa}{For hurdle CBFM models, similar to \code{new_B_space} above but applied to the presence-absence component model.}

\item{new_B_time_pa}{For hurdle CBFM models, similar to \code{new_B_time} above but applied to the presence-absence component model.}

\item{new_B_spacetime_pa}{For hurdle CBFM models, similar to \code{new_B_spacetime} above but applied to the presence-absence component model.}

\item{newdata_count}{For hurdle CBFM models, similar to \code{newdata} above but applied to the zero-truncated count component model.}

\item{manualX_count}{For hurdle CBFM models, similar to \code{manual_X} above but applied to the zero-truncated count component model.}

\item{new_B_space_count}{For hurdle CBFM models, similar to \code{new_B_space} above but applied to the zero-truncated count component model.}

\item{new_B_time_count}{For hurdle CBFM models, similar to \code{new_B_time} above but applied to the zero-truncated count component model.}

\item{new_B_spacetime_count}{For hurdle CBFM models, similar to \code{new_B_spacetime} above but applied to the zero-truncated count component model.}
}
\value{
If \code{se_fit = TRUE}, then a list with the following components (if applicable) is returned:
\item{fit: }{A matrix of predicted values.}
\item{stderr: }{A matrix of standard errors associated with the uncertainty intervals for the predictions.}
\item{lower: }{A matrix of the lower bound of the uncertainty intervals for the predictions.}
\item{upper: }{A matrix of the upper bound of the uncertainty intervals for the predictions.}
Otherwise if \code{se_fit = FALSE}, then a matrix of predicted values is returned.

Other if \code{type = "lpmatrix"}, then a model matrix with the number of rows equal to either the number of rows if \code{object$y} (if \code{newdata} is not supplied) or the number of rows in \code{newdata} when it is supplied.
}
\description{
\ifelse{html}{\href{https://lifecycle.r-lib.org/articles/stages.html#experimental}{\figure{lifecycle-experimental.svg}{options: alt='[Experimental]'}}}{\strong{[Experimental]}}

Takes a fitted \code{CBFM} or \code{CBFM_hurdle} object and produces predictions given (potentially) a new set of observational units with their corresponding covariate and basis function functions. Predictions can be accompanied by standard errors, based on the Bayesian covariance matrix of the parameter estimates. As another option, the function can return the model matrix of the covariates constructed (potentially) using at the new set of observational units; in \code{\link[mgcv:predict.gam]{mgcv::predict.gam()}} this is also known as the linear predictor matrix.
}
\details{
The standard errors produced by \code{predict.CBFM} are based on the Bayesian posterior covariance matrix of the estimated parameters from the fitted \code{CBFM} object, and associated uncertainty intervals are obtained based on the associated large sample normality result of i.e., basically a Gaussian approximation to the posterior to, the estimated parameters. This construction is similar to \code{\link[mgcv:predict.gam]{mgcv::predict.gam()}}.

The functions tries to avoid using simulation for constructing the uncertainty intervals for the predictions (to minimize computational burden) However, in some cases it will fallback to doing so when it can not find a simple way to construct these intervals  (blame Francis!) e.g., for the zero-inflated Poisson distribution when \code{type = "response"}.
}
\examples{
\donttest{
# Please see examples in the help file for the CBFM and makeahurdle functions 
}

}
\seealso{
\code{\link[=CBFM]{CBFM()}} for fitting CBFMs, \code{\link[=fitted.CBFM]{fitted.CBFM()}} for obtaining fitted values from a CBFM fit, and \code{\link[=residuals.CBFM]{residuals.CBFM()}} for calculating various types of residuals.
}
\author{
Francis K.C. Hui \href{mailto:fhui28@gmail.com}{fhui28@gmail.com}, Chris Haak
}
